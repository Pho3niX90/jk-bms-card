function e(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function t(e,t,s,n){var i,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(a<3?i(r):a>3?i(t,s,r):i(t,s))||r);return a>3&&r&&Object.defineProperty(t,s,r),r}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const s=globalThis,n=s.ShadowRoot&&(void 0===s.ShadyCSS||s.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),a=new WeakMap;let r=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(n&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=a.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&a.set(t,e))}return e}toString(){return this.cssText}};const l=n?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new r("string"==typeof e?e:e+"",void 0,i))(t)})(e):e,{is:o,defineProperty:c,getOwnPropertyDescriptor:h,getOwnPropertyNames:_,getOwnPropertySymbols:d,getPrototypeOf:p}=Object,g=globalThis,u=g.trustedTypes,m=u?u.emptyScript:"",f=g.reactiveElementPolyfillSupport,v=(e,t)=>e,b={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},y=(e,t)=>!o(e,t),$={attribute:!0,type:String,converter:b,reflect:!1,useDefault:!1,hasChanged:y};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Symbol.metadata??=Symbol("metadata"),g.litPropertyMetadata??=new WeakMap;let A=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=$){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),n=this.getPropertyDescriptor(e,s,t);void 0!==n&&c(this.prototype,e,n)}}static getPropertyDescriptor(e,t,s){const{get:n,set:i}=h(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){const a=n?.call(this);i?.call(this,t),this.requestUpdate(e,a,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??$}static _$Ei(){if(this.hasOwnProperty(v("elementProperties")))return;const e=p(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(v("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(v("properties"))){const e=this.properties,t=[..._(e),...d(e)];for(const s of t)this.createProperty(s,e[s])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const s=this._$Eu(e,t);void 0!==s&&this._$Eh.set(s,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(l(e))}else void 0!==e&&t.push(l(e));return t}static _$Eu(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(n)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const n of t){const t=document.createElement("style"),i=s.litNonce;void 0!==i&&t.setAttribute("nonce",i),t.textContent=n.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$ET(e,t){const s=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,s);if(void 0!==n&&!0===s.reflect){const i=(void 0!==s.converter?.toAttribute?s.converter:b).toAttribute(t,s.type);this._$Em=e,null==i?this.removeAttribute(n):this.setAttribute(n,i),this._$Em=null}}_$AK(e,t){const s=this.constructor,n=s._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=s.getPropertyOptions(n),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:b;this._$Em=n;const a=i.fromAttribute(t,e.type);this[n]=a??this._$Ej?.get(n)??a,this._$Em=null}}requestUpdate(e,t,s){if(void 0!==e){const n=this.constructor,i=this[e];if(s??=n.getPropertyOptions(e),!((s.hasChanged??y)(i,t)||s.useDefault&&s.reflect&&i===this._$Ej?.get(e)&&!this.hasAttribute(n._$Eu(e,s))))return;this.C(e,t,s)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:s,reflect:n,wrapped:i},a){s&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==i||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||s||(t=void 0),this._$AL.set(e,t)),!0===n&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,s]of e){const{wrapped:e}=s,n=this[t];!0!==e||this._$AL.has(t)||void 0===n||this.C(t,void 0,s,n)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}};A.elementStyles=[],A.shadowRootOptions={mode:"open"},A[v("elementProperties")]=new Map,A[v("finalized")]=new Map,f?.({ReactiveElement:A}),(g.reactiveElementVersions??=[]).push("2.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const C=globalThis,S=C.trustedTypes,w=S?S.createPolicy("lit-html",{createHTML:e=>e}):void 0,E="$lit$",x=`lit$${Math.random().toFixed(9).slice(2)}$`,k="?"+x,P=`<${k}>`,O=document,M=()=>O.createComment(""),T=e=>null===e||"object"!=typeof e&&"function"!=typeof e,U=Array.isArray,H="[ \t\n\f\r]",N=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,R=/-->/g,L=/>/g,D=RegExp(`>|${H}(?:([^\\s"'>=/]+)(${H}*=${H}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),I=/'/g,j=/"/g,B=/^(?:script|style|textarea|title)$/i,z=(e=>(t,...s)=>({_$litType$:e,strings:t,values:s}))(1),V=Symbol.for("lit-noChange"),F=Symbol.for("lit-nothing"),q=new WeakMap,W=O.createTreeWalker(O,129);function J(e,t){if(!U(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==w?w.createHTML(t):t}const K=(e,t)=>{const s=e.length-1,n=[];let i,a=2===t?"<svg>":3===t?"<math>":"",r=N;for(let t=0;t<s;t++){const s=e[t];let l,o,c=-1,h=0;for(;h<s.length&&(r.lastIndex=h,o=r.exec(s),null!==o);)h=r.lastIndex,r===N?"!--"===o[1]?r=R:void 0!==o[1]?r=L:void 0!==o[2]?(B.test(o[2])&&(i=RegExp("</"+o[2],"g")),r=D):void 0!==o[3]&&(r=D):r===D?">"===o[0]?(r=i??N,c=-1):void 0===o[1]?c=-2:(c=r.lastIndex-o[2].length,l=o[1],r=void 0===o[3]?D:'"'===o[3]?j:I):r===j||r===I?r=D:r===R||r===L?r=N:(r=D,i=void 0);const _=r===D&&e[t+1].startsWith("/>")?" ":"";a+=r===N?s+P:c>=0?(n.push(l),s.slice(0,c)+E+s.slice(c)+x+_):s+x+(-2===c?t:_)}return[J(e,a+(e[s]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),n]};class Z{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,a=0;const r=e.length-1,l=this.parts,[o,c]=K(e,t);if(this.el=Z.createElement(o,s),W.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=W.nextNode())&&l.length<r;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(E)){const t=c[a++],s=n.getAttribute(e).split(x),r=/([.?@])?(.*)/.exec(t);l.push({type:1,index:i,name:r[2],strings:s,ctor:"."===r[1]?ee:"?"===r[1]?te:"@"===r[1]?se:Q}),n.removeAttribute(e)}else e.startsWith(x)&&(l.push({type:6,index:i}),n.removeAttribute(e));if(B.test(n.tagName)){const e=n.textContent.split(x),t=e.length-1;if(t>0){n.textContent=S?S.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],M()),W.nextNode(),l.push({type:2,index:++i});n.append(e[t],M())}}}else if(8===n.nodeType)if(n.data===k)l.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(x,e+1));)l.push({type:7,index:i}),e+=x.length-1}i++}}static createElement(e,t){const s=O.createElement("template");return s.innerHTML=e,s}}function X(e,t,s=e,n){if(t===V)return t;let i=void 0!==n?s._$Co?.[n]:s._$Cl;const a=T(t)?void 0:t._$litDirective$;return i?.constructor!==a&&(i?._$AO?.(!1),void 0===a?i=void 0:(i=new a(e),i._$AT(e,s,n)),void 0!==n?(s._$Co??=[])[n]=i:s._$Cl=i),void 0!==i&&(t=X(e,i._$AS(e,t.values),i,n)),t}class Y{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,n=(e?.creationScope??O).importNode(t,!0);W.currentNode=n;let i=W.nextNode(),a=0,r=0,l=s[0];for(;void 0!==l;){if(a===l.index){let t;2===l.type?t=new G(i,i.nextSibling,this,e):1===l.type?t=new l.ctor(i,l.name,l.strings,this,e):6===l.type&&(t=new ne(i,this,e)),this._$AV.push(t),l=s[++r]}a!==l?.index&&(i=W.nextNode(),a++)}return W.currentNode=O,n}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class G{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,n){this.type=2,this._$AH=F,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=X(this,e,t),T(e)?e===F||null==e||""===e?(this._$AH!==F&&this._$AR(),this._$AH=F):e!==this._$AH&&e!==V&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>U(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==F&&T(this._$AH)?this._$AA.nextSibling.data=e:this.T(O.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=Z.createElement(J(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new Y(n,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=q.get(e.strings);return void 0===t&&q.set(e.strings,t=new Z(e)),t}k(e){U(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new G(this.O(M()),this.O(M()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Q{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,n,i){this.type=1,this._$AH=F,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=F}_$AI(e,t=this,s,n){const i=this.strings;let a=!1;if(void 0===i)e=X(this,e,t,0),a=!T(e)||e!==this._$AH&&e!==V,a&&(this._$AH=e);else{const n=e;let r,l;for(e=i[0],r=0;r<i.length-1;r++)l=X(this,n[s+r],t,r),l===V&&(l=this._$AH[r]),a||=!T(l)||l!==this._$AH[r],l===F?e=F:e!==F&&(e+=(l??"")+i[r+1]),this._$AH[r]=l}a&&!n&&this.j(e)}j(e){e===F?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends Q{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===F?void 0:e}}class te extends Q{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==F)}}class se extends Q{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){if((e=X(this,e,t,0)??F)===V)return;const s=this._$AH,n=e===F&&s!==F||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==F&&(s===F||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ne{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){X(this,e)}}const ie=C.litHtmlPolyfillSupport;ie?.(Z,G),(C.litHtmlVersions??=[]).push("3.3.1");const ae=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class re extends A{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,s)=>{const n=s?.renderBefore??t;let i=n._$litPart$;if(void 0===i){const e=s?.renderBefore??null;n._$litPart$=i=new G(t.insertBefore(M(),e),e,void 0,s??{})}return i._$AI(e),i})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return V}}re._$litElement$=!0,re.finalized=!0,ae.litElementHydrateSupport?.({LitElement:re});const le=ae.litElementPolyfillSupport;le?.({LitElement:re}),(ae.litElementVersions??=[]).push("4.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const oe=e=>(t,s)=>{void 0!==s?s.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)},ce={attribute:!0,type:String,converter:b,reflect:!1,hasChanged:y},he=(e=ce,t,s)=>{const{kind:n,metadata:i}=s;let a=globalThis.litPropertyMetadata.get(i);if(void 0===a&&globalThis.litPropertyMetadata.set(i,a=new Map),"setter"===n&&((e=Object.create(e)).wrapped=!0),a.set(s.name,e),"accessor"===n){const{name:n}=s;return{set(s){const i=t.get.call(this);t.set.call(this,s),this.requestUpdate(n,i,e)},init(t){return void 0!==t&&this.C(n,void 0,e,t),t}}}if("setter"===n){const{name:n}=s;return function(s){const i=this[n];t.call(this,s),this.requestUpdate(n,i,e)}}throw Error("Unsupported decorator location: "+n)};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function _e(e){return(t,s)=>"object"==typeof s?he(e,t,s):((e,t,s)=>{const n=t.hasOwnProperty(s);return t.constructor.createProperty(s,e),n?Object.getOwnPropertyDescriptor(t,s):void 0})(e,t,s)}const de="jk-bms-content-card-editor",pe="jk-bms-card";var ge;!function(e){e.delta_cell_voltage="delta_cell_voltage",e.balancing_current="balancing_current",e.power="power",e.balance_trigger_voltage="balance_trigger_voltage",e.total_runtime_formatted="total_runtime_formatted",e.charging="charging",e.discharging="discharging",e.balancer="balancer",e.heater="heater",e.total_voltage="total_voltage",e.total_battery_capacity_setting="total_battery_capacity_setting",e.total_charging_cycle_capacity="total_charging_cycle_capacity",e.average_cell_voltage="average_cell_voltage",e.current="current",e.state_of_charge="state_of_charge",e.capacity_remaining="capacity_remaining",e.charging_cycles="charging_cycles",e.power_tube_temperature="power_tube_temperature",e.min_voltage_cell="min_voltage_cell",e.max_voltage_cell="max_voltage_cell",e.errors="errors",e.cell_voltage_1="cell_voltage_1",e.cell_voltage_2="cell_voltage_2",e.cell_voltage_3="cell_voltage_3",e.cell_voltage_4="cell_voltage_4",e.cell_voltage_5="cell_voltage_5",e.cell_voltage_6="cell_voltage_6",e.cell_voltage_7="cell_voltage_7",e.cell_voltage_8="cell_voltage_8",e.cell_voltage_9="cell_voltage_9",e.cell_voltage_10="cell_voltage_10",e.cell_voltage_11="cell_voltage_11",e.cell_voltage_12="cell_voltage_12",e.cell_voltage_13="cell_voltage_13",e.cell_voltage_14="cell_voltage_14",e.cell_voltage_15="cell_voltage_15",e.cell_voltage_16="cell_voltage_16",e.cell_voltage_17="cell_voltage_17",e.cell_voltage_18="cell_voltage_18",e.cell_voltage_19="cell_voltage_19",e.cell_voltage_20="cell_voltage_20",e.cell_voltage_21="cell_voltage_21",e.cell_voltage_22="cell_voltage_22",e.cell_voltage_23="cell_voltage_23",e.cell_voltage_24="cell_voltage_24",e.cell_voltage_25="cell_voltage_25",e.cell_voltage_26="cell_voltage_26",e.cell_voltage_27="cell_voltage_27",e.cell_voltage_28="cell_voltage_28",e.cell_voltage_29="cell_voltage_29",e.cell_voltage_30="cell_voltage_30",e.cell_voltage_31="cell_voltage_31",e.cell_voltage_32="cell_voltage_32",e.cell_resistance_1="cell_resistance_1",e.cell_resistance_2="cell_resistance_2",e.cell_resistance_3="cell_resistance_3",e.cell_resistance_4="cell_resistance_4",e.cell_resistance_5="cell_resistance_5",e.cell_resistance_6="cell_resistance_6",e.cell_resistance_7="cell_resistance_7",e.cell_resistance_8="cell_resistance_8",e.cell_resistance_9="cell_resistance_9",e.cell_resistance_10="cell_resistance_10",e.cell_resistance_11="cell_resistance_11",e.cell_resistance_12="cell_resistance_12",e.cell_resistance_13="cell_resistance_13",e.cell_resistance_14="cell_resistance_14",e.cell_resistance_15="cell_resistance_15",e.cell_resistance_16="cell_resistance_16",e.cell_resistance_17="cell_resistance_17",e.cell_resistance_18="cell_resistance_18",e.cell_resistance_19="cell_resistance_19",e.cell_resistance_20="cell_resistance_20",e.cell_resistance_21="cell_resistance_21",e.cell_resistance_22="cell_resistance_22",e.cell_resistance_23="cell_resistance_23",e.cell_resistance_24="cell_resistance_24",e.cell_resistance_25="cell_resistance_25",e.cell_resistance_26="cell_resistance_26",e.cell_resistance_27="cell_resistance_27",e.cell_resistance_28="cell_resistance_28",e.cell_resistance_29="cell_resistance_29",e.cell_resistance_30="cell_resistance_30",e.cell_resistance_31="cell_resistance_31",e.cell_resistance_32="cell_resistance_32",e.temperature_sensor_1="temperature_sensor_1",e.temperature_sensor_2="temperature_sensor_2",e.temperature_sensor_3="temperature_sensor_3",e.temperature_sensor_4="temperature_sensor_4"}(ge||(ge={}));var ue={title:"JK BMS Card",description:"A customizable Home Assistant card to emulate the JK BMS screen",version:"Version"},me={title:"Title",prefix:"Prefix of the sensors",cellCount:"Number of cells",cellColumns:"Number of columns",cellLayout:"Cell Layout",manualAssignment:"Manual entity assignment",tempSensorsCount:"Number of temperature sensors available",hasHeater:"Heater option is used"},fe={charge:"Charge",discharge:"Discharge",balance:"Balance",heater:"Heater"},ve={power:"Power:",capacity:"Capacity:",cycleCapacity:"Cycle Cap:",averageCellV:"Avg Cell V:",balanceCurrent:"Balance Cur:",stateOfCharge:"SOC:",remainingAmps:"Remaining:",cycles:"Cycles:",delta:"Delta V:",mosfetTemp:"MOS Temp:",temperature_sensor_1:"Temp. 1:",temperature_sensor_2:"Temp. 2:",temperature_sensor_3:"Temp. 3:",temperature_sensor_4:"Temp. 4:"},be={common:ue,config:me,switches:fe,stats:ve};const ye={hass:null},$e={en:Object.freeze({__proto__:null,common:ue,config:me,default:be,stats:ve,switches:fe})};function Ae(e,t="",s=""){try{const n=(localStorage.getItem("selectedLanguage")||"en").replace(/['"]+/g,"").replace("-","_"),i="".concat(ye.hass?.selectedLanguage||ye.hass?.locale?.language||ye.hass?.language||n);let a;try{a=e?.split(".").reduce((e,t)=>e[t],$e[i])}catch(t){a=e?.split(".")?.reduce((e,t)=>e[t],$e.en)}return void 0===a&&(a=e?.split(".")?.reduce((e,t)=>e[t],$e.en)),""!==t&&""!==s&&(a=a.replace(t,s)),a}catch(t){return e}}var Ce,Se,we,Ee,xe,ke,Pe,Oe,Me,Te,Ue,He,Ne,Re,Le;const De="1.1.0";console.groupCollapsed("%cðŸ”‹ JK-BMS Battery Card%c   ready!  ðŸš€ (v".concat(De,")"),"background: linear-gradient(to right, #41cd52, #3090c7); color: white; font-weight: bold; padding: 2px 8px; border-radius: 6px;","background: none; color: #AAA; font-style: italic;"),console.log("%cðŸ“– Docs:","color: #41cd52; font-weight: bold;","https://github.com/Pho3niX90/jk-bms-card"),console.groupEnd();let Ie=Le=class extends re{constructor(){super(...arguments),this.minCellId="",this.maxCellId="",this.maxDeltaV=0,this.shouldBalance=!1}setConfig(e){this._config=Le.getStubConfig(),this._config={...this._config,...e}}static getStubConfig(){return{title:Ae("title"),prefix:"jk_bms",cellCount:16,cellColumns:2,cellLayout:"bankMode",tempSensorsCount:0,hasHeater:0,entities:Object.keys(ge).reduce((e,t)=>(e[t]="",e),{})}}static async getConfigElement(){return await Promise.resolve().then(function(){return qe}),document.createElement(de)}getCardSize(){return 3}_navigate(e,t,s="sensor"){if(!e)return;e.stopPropagation();const n=this.configOrEnum(t),i=n.includes("sensor.")||n.includes("switch.")||n.includes("number.")?n:s+"."+this._config?.prefix+"_"+n;let a=new CustomEvent("hass-more-info",{detail:{entityId:i},composed:!0});e.target.dispatchEvent(a)}getState(e,t=2,s="",n="sensor"){const i=this.configOrEnum(e);if(!i)return s;const a=i.includes("sensor.")||i.includes("switch.")||i.includes("number.")?i:"".concat(n,".").concat(this._config.prefix,"_").concat(i),r=this.hass?.states[a],l=r?.state,o=Number(l);return isNaN(o)?l??s:o.toFixed(t)}_renderSwitch(t,s){const n=this.getState(t,0,"","switch"),i="on"===n?"status-on":"status-off";return z(Ce||(Ce=e(['\n      <div class="button-border button-padding center clickable" @click=',">\n        ",': <span class="','">',"</span>\n      </div>\n    "])),e=>this._navigate(e,t,"switch"),Ae("switches."+s),i,n.toUpperCase())}configOrEnum(e){const t=this._config?.entities[e]?.toString()?.trim();return t&&t.length>1?t:e?.toString()}render(){if(ye.hass=this.hass,!this.hass||!this._config)return z(Se||(Se=e([""])));const t=this._config.title||"Bat 1";this.maxDeltaV=parseFloat(this.getState(ge.delta_cell_voltage,3,"0"));const s=parseFloat(this.getState(ge.balancing_current,2,"0")),n=parseFloat(this.getState(ge.power,2,"0")),i=Number(this.getState(ge.balance_trigger_voltage,2,"","number"));this.shouldBalance=this.maxDeltaV>=i,this.shouldBalance=this.maxDeltaV>=i;const a=n>0?"power-positive":n<0?"power-negative":"power-even",r=s>0?"balance-positive":s<0?"balance-negative":"balance-even",l=this.shouldBalance?"delta-needs-balancing":"delta-ok",o=this.getState(ge.total_runtime_formatted),c=o&&"unknown"!=o?z(we||(we=e([' | Time: <b><font color="#3090C7">',"</font></b>"])),o.toUpperCase()):"";return z(Ee||(Ee=e(['\n      <ha-card>\n        <div class="grid grid-1 p-3 section-padding">\n          <div class="center clickable" @click=',">\n            ","",'\n          </div>\n        </div>\n\n        <div class="grid grid-','">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n          \n          ",'\n\n        <div class="grid grid-2 section-padding">\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," V</font></b>\n            </div>\n              ",' <span class="clickable ','" @click=',">"," W</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," V</span><br>\n              ",' <span class="','">\n              '," A\n            </span>\n              ",'\n          </div>\n\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," A</font></b>\n            </div>\n              ",' <span class="clickable" @click=',">"," %</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">","</span><br>\n              ",' <span class="','" @click=',"> "," V </span><br>\n              ",' <span class="clickable" @click=',">"," Â°C</span>\n              ",'\n          </div>\n        </div>\n\n          <svg class="flow-line" id="flow-svg">\n              <path id="flow-path" fill="none" />\n          </svg>\n\n          <div class="grid grid-','">\n          ',"\n        </div>\n      </ha-card>\n    "])),e=>this._navigate(e,ge.total_runtime_formatted),t,c,"1"==this._config.hasHeater?"4":"3",this._renderSwitch(ge.charging,"charge"),this._renderSwitch(ge.discharging,"discharge"),this._renderSwitch(ge.balancer,"balance"),"1"==this._config.hasHeater?this._renderSwitch(ge.heater,"heater"):"",this._renderError(),e=>this._navigate(e,ge.total_voltage),this.getState(ge.total_voltage),Ae("stats.power"),a,e=>this._navigate(e,ge.power),this.getState(ge.power),Ae("stats.capacity"),e=>this._navigate(e,ge.total_battery_capacity_setting),this.getState(ge.total_battery_capacity_setting),Ae("stats.cycleCapacity"),e=>this._navigate(e,ge.total_charging_cycle_capacity),this.getState(ge.total_charging_cycle_capacity),Ae("stats.averageCellV"),e=>this._navigate(e,ge.average_cell_voltage),this.getState(ge.average_cell_voltage,3),Ae("stats.balanceCurrent"),r,s.toFixed(1),this._renderTemps(1),e=>this._navigate(e,ge.current),this.getState(ge.current),Ae("stats.stateOfCharge"),e=>this._navigate(e,ge.state_of_charge),this.getState(ge.state_of_charge),Ae("stats.remainingAmps"),e=>this._navigate(e,ge.capacity_remaining),this.getState(ge.capacity_remaining),Ae("stats.cycles"),e=>this._navigate(e,ge.charging_cycles),this.getState(ge.charging_cycles),Ae("stats.delta"),l,e=>this._navigate(e,ge.delta_cell_voltage),this.maxDeltaV.toFixed(3),Ae("stats.mosfetTemp"),e=>this._navigate(e,ge.power_tube_temperature),this.getState(ge.power_tube_temperature),this._renderTemps(2),this._config.cellColumns??2,this._renderCells("bankMode"==this._config.cellLayout))}updated(){requestAnimationFrame(()=>this._updateFlowLine())}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._updateFlowLine.bind(this))}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._updateFlowLine.bind(this))}_renderError(){const t=this.getState(ge.errors,0);return t.trim().length<=1||"0"==t?z(xe||(xe=e([""]))):z(ke||(ke=e(['<span class="error-message">',"</span>"])),t)}_renderTemps(t){const s=[],n=this._config?.tempSensorsCount??0;for(let i=t;i<=n;i+=2)s.push(z(Pe||(Pe=e(["\n                <br>",' <span class="clickable" @click=',">"," Â°C</span>"])),Ae("stats.temperature_sensor_"+i),e=>this._navigate(e,ge["temperature_sensor_"+i]),this.getState(ge["temperature_sensor_"+i])));return z(Oe||(Oe=e(["",""])),s)}_renderCells(t=!0){const s=[],n=this._config?.cellColumns??2,i=this._config?.cellCount??16,a=Math.floor(i/n),r=t?Math.ceil(i/n):i,l=i%n;this.minCellId=this.getState(ge.min_voltage_cell,0),this.maxCellId=this.getState(ge.max_voltage_cell,0),!this.minCellId||!this.maxCellId||!this.maxDeltaV||this.maxDeltaV,this.calculateDynamicMinMaxCellId(i);for(let e=1;e<=r;e++)if(t&&l&&e==r?s.push(this._createCell(i)):s.push(this._createCell(e)),t&&(e<r||!l))for(let t=1;t<n;t++)s.push(this._createCell(e+a*t));return z(Me||(Me=e(["",""])),s)}calculateDynamicMinMaxCellId(e){let t=1/0,s=-1/0,n=0,i=0;for(let a=1;a<=e;a++){const e=this.getState(ge["cell_voltage_".concat(a)],3,""),r=parseFloat(e);isNaN(r)||(r>s&&(s=r,i=a),r<t&&(t=r,n=a))}this.minCellId=String(n),this.maxCellId=String(i),this.maxDeltaV=Number((s-t).toFixed(3))}getMinMaxCell(){return{minId:this.getState(ge.min_voltage_cell),maxId:this.getState(ge.max_voltage_cell)}}_createCell(t){const s=this.getState(ge["cell_voltage_".concat(t)],3,"0.0"),n=this.getState(ge["cell_resistance_".concat(t)],3),i=this.minCellId,a=this.maxCellId,r=t.toString()===i?"voltage-low":t.toString()===a?"voltage-high":"";let l=""==n?"":z(Te||(Te=e(['\n            <span class="clickable" @click=',">\n            / "," Î©\n          </span>"])),e=>this._navigate(e,ge["cell_resistance_".concat(t)]),n);return z(Ue||(Ue=e(['\n            <div class="center cell-container" id="cell-','">\n            <span class="clickable" @click=','>\n                <span class="pill">',"</span>\n            ","\n          </span>\n                ","\n            </div>\n        "])),t,e=>this._navigate(e,ge["cell_voltage_".concat(t)]),t.toString().padStart(2,"0"),r?z(He||(He=e(['<span class="','">'," V</span>"])),r,s):z(Ne||(Ne=e([""," V"])),s),l)}_updateFlowLine(){const e=parseFloat(this.getState(ge.balancing_current,3,"0")),t=this.renderRoot.querySelector("#cell-".concat(this.minCellId)),s=this.renderRoot.querySelector("#cell-".concat(this.maxCellId)),n=this.renderRoot.querySelector("#flow-path");if(!n)return;if(!this.shouldBalance&&0===e||!t||!s)return n.setAttribute("d",""),void(n.style.display="none");n.style.display="inline";const i=(this.renderRoot instanceof ShadowRoot?this.renderRoot.host:this).getBoundingClientRect(),a=t.getBoundingClientRect(),r=e=>{const t=e.left+e.width/2<i.left+i.width/2?"right":"left";return{side:t,x:"right"===t?e.right-i.left:e.left-i.left,y:e.top+e.height/2-i.top}},l=r(s.getBoundingClientRect()),o=r(a);let c;if(l.side===o.side){const e="right"===l.side?l.x+10:l.x-10;c="M ".concat(l.x,",").concat(l.y,"\n             L ").concat(e,",").concat(l.y,"\n             L ").concat(e,",").concat(o.y,"\n             L ").concat(o.x,",").concat(o.y)}else{const e=(l.x+o.x)/2;c="M ".concat(l.x,",").concat(l.y,"\n             L ").concat(e,",").concat(l.y,"\n             L ").concat(e,",").concat(o.y,"\n             L ").concat(o.x,",").concat(o.y)}n.setAttribute("d",c)}};var je,Be;Ie.styles=((e,...t)=>{const s=1===e.length?e[0]:t.reduce((t,s,n)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+e[n+1],e[0]);return new r(s,e,i)})(Re||(Re=e(["\n        .grid {\n            display: grid;\n            gap: 4px;\n            margin: 4px;\n        }\n        .grid-1 { grid-template-columns: 1fr; }\n        .grid-2 { grid-template-columns: repeat(2, 1fr); }\n        .grid-3 { grid-template-columns: repeat(3, 1fr); }\n        .grid-4 { grid-template-columns: repeat(4, 1fr); }\n        .grid-5 { grid-template-columns: repeat(5, 1fr); }\n        .grid-6 { grid-template-columns: repeat(6, 1fr); }\n        .grid-7 { grid-template-columns: repeat(7, 1fr); }\n        .grid-8 { grid-template-columns: repeat(8, 1fr); }\n        .clickable {\n            cursor: pointer;\n        }\n        .section-padding {\n            padding-top: 0.45rem;\n            padding-bottom: 0.75rem;\n        }\n        .stats-padding {\n            padding-top: 0.75rem;\n            padding-left: 0.75rem;\n        }\n        .power-negative {\n            color: red\n        }\n        .power-positive {\n            color: #41cd52\n        }\n        .power-even {\n            color: #808080\n        }\n        .balance-positive {\n            color: red\n        }\n        .balance-negative {\n            color: #3090C7\n        }\n        .balance-even {\n            color: #808080\n        }\n        .delta-needs-balancing {\n            color: #FFA500\n        }\n        .delta-ok {\n            color: #41CD52\n        }\n        .stats-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n        .button-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n        .error-message {\n            color: red;\n            font-style: italic;\n        }\n        .button-padding {\n            padding-top: 0.75rem;\n            padding-bottom: 0.75rem;\n        }\n        .status-on { color: #41cd52; }\n        .status-off { color: red; }\n        .voltage-high { color: #3090C7; }\n        .voltage-low { color: red; }\n        .center { text-align: center; }\n        .pill {\n            display: inline-block;\n            padding: 0.15rem 0.25rem;\n            background-color: #195569;\n            color: #e4f3f8;\n            border-radius: 999px;\n            font-weight: 500;\n            font-family: sans-serif;\n            font-size: 0.9rem;\n            min-width: 2rem;\n            text-align: center;\n        }\n        .flow-line {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n            z-index: 1;\n        }\n        \n        line {\n            stroke: #3090C7;\n            stroke-width: 2;\n            stroke-dasharray: 6;\n            animation: dashmove 1s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n        }\n        path {\n            stroke: #3090C7;\n            stroke-width: 3;\n            stroke-linecap: round;\n            fill: none;\n            stroke-dasharray: 10;\n            stroke-dashoffset: 0;\n            animation: dashmove 1.2s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n         }\n\n        @keyframes dashmove {\n            from {\n                stroke-dashoffset: 0;\n            }\n            to {\n                stroke-dashoffset: -20;\n            }\n        }\n    "]))),t([_e()],Ie.prototype,"hass",void 0),t([_e()],Ie.prototype,"_config",void 0),Ie=Le=t([oe(pe)],Ie),window.customCards.push({type:pe,name:"JK BMS Card",preview:!0,description:Ae("common.description"),configurable:!0}),function(e){e.language="language",e.system="system",e.comma_decimal="comma_decimal",e.decimal_comma="decimal_comma",e.space_comma="space_comma",e.none="none"}(je||(je={})),function(e){e.language="language",e.system="system",e.am_pm="12",e.twenty_four="24"}(Be||(Be={}));var ze,Ve;let Fe=class extends re{constructor(){super(...arguments),this._computeLabelCallback=e=>Ae("config.".concat(e.name))??e.name}setConfig(e){this._config={...this._config,...e}}render(){if(!this._config||!this.hass)return z(ze||(ze=e([""])));const t=Object.values(ge).map(e=>({name:e,selector:{entity:{}}}));return z(Ve||(Ve=e(["\n\t\t\t<ha-form\n\t\t\t\t.hass=","\n\t\t\t\t.data=","\n\t\t\t\t.computeLabel=","\n\t\t\t\t.schema=","\n\t\t\t\t@value-changed=","\n\t\t\t></ha-form>\n\t\t"])),this.hass,this._config,this._computeLabelCallback.bind(this),[{type:"grid",title:Ae("config.title"),schema:[{type:"grid",schema:[{name:"title",selector:{text:{}}}]}]},{type:"grid",title:Ae("config.prefix"),schema:[{type:"grid",schema:[{name:"prefix",selector:{text:{}}}]}]},{type:"grid",title:Ae("config.cellCount"),schema:[{type:"grid",schema:[{name:"cellCount",selector:{number:{min:2,max:48,step:2}}},{name:"cellColumns",selector:{number:{min:1,max:8,step:1}}},{name:"cellLayout",selector:{select:{options:[{label:"Incremental",value:"incremental"},{label:"Bank Mode",value:"bankMode"}]}}}]}]},{type:"grid",title:Ae("config.tempSensorsCount"),schema:[{type:"grid",schema:[{name:"tempSensorsCount",selector:{number:{min:0,max:4,step:2}}}]}]},{type:"grid",title:Ae("config.hasHeater"),schema:[{type:"grid",schema:[{name:"hasHeater",selector:{select:{multiple:!1,mode:"list",options:[{label:"Yes",value:"1"},{label:"No",value:"0"}]}}}]}]},{type:"expandable",title:Ae("config.manualAssignment"),schema:[{name:"entities",type:"grid",schema:t}]}],this._valueChanged.bind(this))}_valueChanged(e){!function(e,t,s,n){n=n||{},s=null==s?{}:s;var i=new Event(t,{bubbles:void 0===n.bubbles||n.bubbles,cancelable:Boolean(n.cancelable),composed:void 0===n.composed||n.composed});i.detail=s,e.dispatchEvent(i)}(this,"config-changed",{config:e.detail.value})}};t([_e()],Fe.prototype,"hass",void 0),t([_e()],Fe.prototype,"_config",void 0),t([_e()],Fe.prototype,"lovelace",void 0),Fe=t([oe(de)],Fe);var qe=Object.freeze({__proto__:null,get JkBmsCardEditor(){return Fe}});export{De as CARD_VERSION,Ie as JkBmsCard};
