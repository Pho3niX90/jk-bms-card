function e(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function t(e,t,n,s){var i,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,s);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const n=globalThis,s=n.ShadowRoot&&(void 0===n.ShadyCSS||n.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),a=new WeakMap;let r=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(s&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=a.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&a.set(t,e))}return e}toString(){return this.cssText}};const l=(e,...t)=>{const n=1===e.length?e[0]:t.reduce(((t,n,s)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[s+1]),e[0]);return new r(n,e,i)},o=s?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new r("string"==typeof e?e:e+"",void 0,i))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:c,defineProperty:h,getOwnPropertyDescriptor:d,getOwnPropertyNames:_,getOwnPropertySymbols:p,getPrototypeOf:g}=Object,u=globalThis,v=u.trustedTypes,m=v?v.emptyScript:"",f=u.reactiveElementPolyfillSupport,b=(e,t)=>e,y={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},x=(e,t)=>!c(e,t),w={attribute:!0,type:String,converter:y,reflect:!1,useDefault:!1,hasChanged:x};Symbol.metadata??=Symbol("metadata"),u.litPropertyMetadata??=new WeakMap;let $=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=w){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(e,n,t);void 0!==s&&h(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){const{get:s,set:i}=d(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const a=s?.call(this);i?.call(this,t),this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??w}static _$Ei(){if(this.hasOwnProperty(b("elementProperties")))return;const e=g(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(b("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(b("properties"))){const e=this.properties,t=[..._(e),...p(e)];for(const n of t)this.createProperty(n,e[n])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,n]of t)this.elementProperties.set(e,n)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const n=this._$Eu(e,t);void 0!==n&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(o(e))}else void 0!==e&&t.push(o(e));return t}static _$Eu(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(s)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const s of t){const t=document.createElement("style"),i=n.litNonce;void 0!==i&&t.setAttribute("nonce",i),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){const n=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,n);if(void 0!==s&&!0===n.reflect){const i=(void 0!==n.converter?.toAttribute?n.converter:y).toAttribute(t,n.type);this._$Em=e,null==i?this.removeAttribute(s):this.setAttribute(s,i),this._$Em=null}}_$AK(e,t){const n=this.constructor,s=n._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=n.getPropertyOptions(s),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:y;this._$Em=s,this[s]=i.fromAttribute(t,e.type)??this._$Ej?.get(s)??null,this._$Em=null}}requestUpdate(e,t,n){if(void 0!==e){const s=this.constructor,i=this[e];if(n??=s.getPropertyOptions(e),!((n.hasChanged??x)(i,t)||n.useDefault&&n.reflect&&i===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,n))))return;this.C(e,t,n)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:s,wrapped:i},a){n&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==i||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,n]of e){const{wrapped:e}=n,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,n,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};$.elementStyles=[],$.shadowRootOptions={mode:"open"},$[b("elementProperties")]=new Map,$[b("finalized")]=new Map,f?.({ReactiveElement:$}),(u.reactiveElementVersions??=[]).push("2.1.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const S=globalThis,C=S.trustedTypes,k=C?C.createPolicy("lit-html",{createHTML:e=>e}):void 0,A="$lit$",E=`lit$${Math.random().toFixed(9).slice(2)}$`,O="?"+E,M=`<${O}>`,P=document,D=()=>P.createComment(""),N=e=>null===e||"object"!=typeof e&&"function"!=typeof e,R=Array.isArray,T="[ \t\n\f\r]",I=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,H=/-->/g,U=/>/g,z=RegExp(`>|${T}(?:([^\\s"'>=/]+)(${T}*=${T}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),L=/'/g,j=/"/g,F=/^(?:script|style|textarea|title)$/i,B=(e=>(t,...n)=>({_$litType$:e,strings:t,values:n}))(1),V=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),q=new WeakMap,J=P.createTreeWalker(P,129);function K(e,t){if(!R(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==k?k.createHTML(t):t}const G=(e,t)=>{const n=e.length-1,s=[];let i,a=2===t?"<svg>":3===t?"<math>":"",r=I;for(let t=0;t<n;t++){const n=e[t];let l,o,c=-1,h=0;for(;h<n.length&&(r.lastIndex=h,o=r.exec(n),null!==o);)h=r.lastIndex,r===I?"!--"===o[1]?r=H:void 0!==o[1]?r=U:void 0!==o[2]?(F.test(o[2])&&(i=RegExp("</"+o[2],"g")),r=z):void 0!==o[3]&&(r=z):r===z?">"===o[0]?(r=i??I,c=-1):void 0===o[1]?c=-2:(c=r.lastIndex-o[2].length,l=o[1],r=void 0===o[3]?z:'"'===o[3]?j:L):r===j||r===L?r=z:r===H||r===U?r=I:(r=z,i=void 0);const d=r===z&&e[t+1].startsWith("/>")?" ":"";a+=r===I?n+M:c>=0?(s.push(l),n.slice(0,c)+A+n.slice(c)+E+d):n+E+(-2===c?t:d)}return[K(e,a+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class Z{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let i=0,a=0;const r=e.length-1,l=this.parts,[o,c]=G(e,t);if(this.el=Z.createElement(o,n),J.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=J.nextNode())&&l.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(A)){const t=c[a++],n=s.getAttribute(e).split(E),r=/([.?@])?(.*)/.exec(t);l.push({type:1,index:i,name:r[2],strings:n,ctor:"."===r[1]?te:"?"===r[1]?ne:"@"===r[1]?se:ee}),s.removeAttribute(e)}else e.startsWith(E)&&(l.push({type:6,index:i}),s.removeAttribute(e));if(F.test(s.tagName)){const e=s.textContent.split(E),t=e.length-1;if(t>0){s.textContent=C?C.emptyScript:"";for(let n=0;n<t;n++)s.append(e[n],D()),J.nextNode(),l.push({type:2,index:++i});s.append(e[t],D())}}}else if(8===s.nodeType)if(s.data===O)l.push({type:2,index:i});else{let e=-1;for(;-1!==(e=s.data.indexOf(E,e+1));)l.push({type:7,index:i}),e+=E.length-1}i++}}static createElement(e,t){const n=P.createElement("template");return n.innerHTML=e,n}}function Q(e,t,n=e,s){if(t===V)return t;let i=void 0!==s?n._$Co?.[s]:n._$Cl;const a=N(t)?void 0:t._$litDirective$;return i?.constructor!==a&&(i?._$AO?.(!1),void 0===a?i=void 0:(i=new a(e),i._$AT(e,n,s)),void 0!==s?(n._$Co??=[])[s]=i:n._$Cl=i),void 0!==i&&(t=Q(e,i._$AS(e,t.values),i,s)),t}class X{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,s=(e?.creationScope??P).importNode(t,!0);J.currentNode=s;let i=J.nextNode(),a=0,r=0,l=n[0];for(;void 0!==l;){if(a===l.index){let t;2===l.type?t=new Y(i,i.nextSibling,this,e):1===l.type?t=new l.ctor(i,l.name,l.strings,this,e):6===l.type&&(t=new ie(i,this,e)),this._$AV.push(t),l=n[++r]}a!==l?.index&&(i=J.nextNode(),a++)}return J.currentNode=P,s}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class Y{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,s){this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Q(this,e,t),N(e)?e===W||null==e||""===e?(this._$AH!==W&&this._$AR(),this._$AH=W):e!==this._$AH&&e!==V&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>R(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==W&&N(this._$AH)?this._$AA.nextSibling.data=e:this.T(P.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,s="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Z.createElement(K(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new X(s,this),n=e.u(this.options);e.p(t),this.T(n),this._$AH=e}}_$AC(e){let t=q.get(e.strings);return void 0===t&&q.set(e.strings,t=new Z(e)),t}k(e){R(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const i of e)s===t.length?t.push(n=new Y(this.O(D()),this.O(D()),this,this.options)):n=t[s],n._$AI(i),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ee{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,s,i){this.type=1,this._$AH=W,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=W}_$AI(e,t=this,n,s){const i=this.strings;let a=!1;if(void 0===i)e=Q(this,e,t,0),a=!N(e)||e!==this._$AH&&e!==V,a&&(this._$AH=e);else{const s=e;let r,l;for(e=i[0],r=0;r<i.length-1;r++)l=Q(this,s[n+r],t,r),l===V&&(l=this._$AH[r]),a||=!N(l)||l!==this._$AH[r],l===W?e=W:e!==W&&(e+=(l??"")+i[r+1]),this._$AH[r]=l}a&&!s&&this.j(e)}j(e){e===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class te extends ee{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===W?void 0:e}}class ne extends ee{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==W)}}class se extends ee{constructor(e,t,n,s,i){super(e,t,n,s,i),this.type=5}_$AI(e,t=this){if((e=Q(this,e,t,0)??W)===V)return;const n=this._$AH,s=e===W&&n!==W||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==W&&(n===W||s);s&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class ie{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Q(this,e)}}const ae=S.litHtmlPolyfillSupport;ae?.(Z,Y),(S.litHtmlVersions??=[]).push("3.3.0");const re=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class le extends ${constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,n)=>{const s=n?.renderBefore??t;let i=s._$litPart$;if(void 0===i){const e=n?.renderBefore??null;s._$litPart$=i=new Y(t.insertBefore(D(),e),e,void 0,n??{})}return i._$AI(e),i})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return V}}le._$litElement$=!0,le.finalized=!0,re.litElementHydrateSupport?.({LitElement:le});const oe=re.litElementPolyfillSupport;oe?.({LitElement:le}),(re.litElementVersions??=[]).push("4.2.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ce=e=>(t,n)=>{void 0!==n?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,he={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:x},de=(e=he,t,n)=>{const{kind:s,metadata:i}=n;let a=globalThis.litPropertyMetadata.get(i);if(void 0===a&&globalThis.litPropertyMetadata.set(i,a=new Map),"setter"===s&&((e=Object.create(e)).wrapped=!0),a.set(n.name,e),"accessor"===s){const{name:s}=n;return{set(n){const i=t.get.call(this);t.set.call(this,n),this.requestUpdate(s,i,e)},init(t){return void 0!==t&&this.C(s,void 0,e,t),t}}}if("setter"===s){const{name:s}=n;return function(n){const i=this[s];t.call(this,n),this.requestUpdate(s,i,e)}}throw Error("Unsupported decorator location: "+s)};function _e(e){return(t,n)=>"object"==typeof n?de(e,t,n):((e,t,n)=>{const s=t.hasOwnProperty(n);return t.constructor.createProperty(n,e),s?Object.getOwnPropertyDescriptor(t,n):void 0})(e,t,n)}const pe="jk-bms-content-card-editor",ge="jk-bms-card";var ue;!function(e){e.delta_cell_voltage="delta_cell_voltage",e.balancing_current="balancing_current",e.power="power",e.balance_trigger_voltage="balance_trigger_voltage",e.total_runtime_formatted="total_runtime_formatted",e.charging="charging",e.discharging="discharging",e.balancer="balancer",e.heater="heater",e.total_voltage="total_voltage",e.total_battery_capacity_setting="total_battery_capacity_setting",e.total_charging_cycle_capacity="total_charging_cycle_capacity",e.average_cell_voltage="average_cell_voltage",e.current="current",e.state_of_charge="state_of_charge",e.capacity_remaining="capacity_remaining",e.charging_cycles="charging_cycles",e.power_tube_temperature="power_tube_temperature",e.min_voltage_cell="min_voltage_cell",e.max_voltage_cell="max_voltage_cell",e.errors="errors",e.cell_voltage_1="cell_voltage_1",e.cell_voltage_2="cell_voltage_2",e.cell_voltage_3="cell_voltage_3",e.cell_voltage_4="cell_voltage_4",e.cell_voltage_5="cell_voltage_5",e.cell_voltage_6="cell_voltage_6",e.cell_voltage_7="cell_voltage_7",e.cell_voltage_8="cell_voltage_8",e.cell_voltage_9="cell_voltage_9",e.cell_voltage_10="cell_voltage_10",e.cell_voltage_11="cell_voltage_11",e.cell_voltage_12="cell_voltage_12",e.cell_voltage_13="cell_voltage_13",e.cell_voltage_14="cell_voltage_14",e.cell_voltage_15="cell_voltage_15",e.cell_voltage_16="cell_voltage_16",e.cell_voltage_17="cell_voltage_17",e.cell_voltage_18="cell_voltage_18",e.cell_voltage_19="cell_voltage_19",e.cell_voltage_20="cell_voltage_20",e.cell_voltage_21="cell_voltage_21",e.cell_voltage_22="cell_voltage_22",e.cell_voltage_23="cell_voltage_23",e.cell_voltage_24="cell_voltage_24",e.cell_voltage_25="cell_voltage_25",e.cell_voltage_26="cell_voltage_26",e.cell_voltage_27="cell_voltage_27",e.cell_voltage_28="cell_voltage_28",e.cell_voltage_29="cell_voltage_29",e.cell_voltage_30="cell_voltage_30",e.cell_voltage_31="cell_voltage_31",e.cell_voltage_32="cell_voltage_32",e.cell_resistance_1="cell_resistance_1",e.cell_resistance_2="cell_resistance_2",e.cell_resistance_3="cell_resistance_3",e.cell_resistance_4="cell_resistance_4",e.cell_resistance_5="cell_resistance_5",e.cell_resistance_6="cell_resistance_6",e.cell_resistance_7="cell_resistance_7",e.cell_resistance_8="cell_resistance_8",e.cell_resistance_9="cell_resistance_9",e.cell_resistance_10="cell_resistance_10",e.cell_resistance_11="cell_resistance_11",e.cell_resistance_12="cell_resistance_12",e.cell_resistance_13="cell_resistance_13",e.cell_resistance_14="cell_resistance_14",e.cell_resistance_15="cell_resistance_15",e.cell_resistance_16="cell_resistance_16",e.cell_resistance_17="cell_resistance_17",e.cell_resistance_18="cell_resistance_18",e.cell_resistance_19="cell_resistance_19",e.cell_resistance_20="cell_resistance_20",e.cell_resistance_21="cell_resistance_21",e.cell_resistance_22="cell_resistance_22",e.cell_resistance_23="cell_resistance_23",e.cell_resistance_24="cell_resistance_24",e.cell_resistance_25="cell_resistance_25",e.cell_resistance_26="cell_resistance_26",e.cell_resistance_27="cell_resistance_27",e.cell_resistance_28="cell_resistance_28",e.cell_resistance_29="cell_resistance_29",e.cell_resistance_30="cell_resistance_30",e.cell_resistance_31="cell_resistance_31",e.cell_resistance_32="cell_resistance_32",e.temperature_sensor_1="temperature_sensor_1",e.temperature_sensor_2="temperature_sensor_2",e.temperature_sensor_3="temperature_sensor_3",e.temperature_sensor_4="temperature_sensor_4"}(ue||(ue={}));var ve={title:"JK BMS Card",description:"A customizable Home Assistant card to emulate the JK BMS screen",version:"Version"},me={title:"Title",prefix:"Prefix of the sensors",cellCount:"Number of cells",cellColumns:"Number of columns",cellLayout:"Cell Layout",layout:"Layout",manualAssignment:"Manual entity assignment",tempSensorsCount:"Number of temperature sensors available",hasHeater:"Heater option is used"},fe={charge:"Charge",discharge:"Discharge",balance:"Balance",heater:"Heater"},be={power:"Power:",capacity:"Capacity:",cycleCapacity:"Cycle Cap:",averageCellV:"Avg Cell V:",balanceCurrent:"Balance Cur:",stateOfCharge:"SOC:",remainingAmps:"Remaining:",cycles:"Cycles:",delta:"Delta V:",mosfetTemp:"MOS Temp:",temperature_sensor_1:"Temp. 1:",temperature_sensor_2:"Temp. 2:",temperature_sensor_3:"Temp. 3:",temperature_sensor_4:"Temp. 4:"},ye={common:ve,config:me,switches:fe,stats:be};const xe={hass:null},we={en:Object.freeze({__proto__:null,common:ve,config:me,default:ye,stats:be,switches:fe})};function $e(e,t="",n=""){try{const s=(localStorage.getItem("selectedLanguage")||"en").replace(/['"]+/g,"").replace("-","_"),i="".concat(xe.hass?.selectedLanguage||xe.hass?.locale?.language||xe.hass?.language||s);let a;try{a=e?.split(".").reduce(((e,t)=>e[t]),we[i])}catch(t){a=e?.split(".")?.reduce(((e,t)=>e[t]),we.en)}return void 0===a&&(a=e?.split(".")?.reduce(((e,t)=>e[t]),we.en)),""!==t&&""!==n&&(a=a.replace(t,n)),a}catch(t){return e}}const Se=(e,t)=>{const n=e?.entities[t]?.toString()?.trim();return n&&n.length>1?n:t?.toString()},Ce=(e,t,n,s="sensor")=>{if(!e)return;e.stopPropagation();const i=Se(t,n),a=i.includes("sensor.")||i.includes("switch.")||i.includes("number.")?i:s+"."+t?.prefix+"_"+i;let r=new CustomEvent("hass-more-info",{detail:{entityId:a},composed:!0});e.target.dispatchEvent(r)},ke=(e,t,n,s=2,i="",a="sensor")=>{const r=Se(t,n);if(!r)return i;const l=r.includes("sensor.")||r.includes("switch.")||r.includes("number.")?r:"".concat(a,".").concat(t.prefix,"_").concat(r),o=e?.states[l],c=o?.state,h=Number(c);return isNaN(h)?c??i:h.toFixed(s)};var Ae,Ee,Oe,Me,Pe,De,Ne,Re,Te,Ie,He,Ue,ze,Le;let je=class extends le{constructor(){super(...arguments),this.minCellId="",this.maxCellId="",this.maxDeltaV=0,this.shouldBalance=!1}_navigate(e,t,n="sensor"){Ce(e,this.config,t,n)}getState(e,t=2,n="",s="sensor"){return ke(this.hass,this.config,e,t,n,s)}_renderSwitch(t,n){const s=this.getState(t,0,"","switch"),i="on"===s?"status-on":"status-off";return B(Ae||(Ae=e(['\n      <div class="button-border button-padding center clickable" @click=',">\n        ",': <span class="','">',"</span>\n      </div>\n    "])),(e=>this._navigate(e,t,"switch")),$e("switches."+n),i,s.toUpperCase())}configOrEnum(e){return Se(this.config,e)}render(){if(xe.hass=this.hass,!this.hass||!this.config)return B(Ee||(Ee=e([""])));const t=this.config.title||"Bat 1";this.maxDeltaV=parseFloat(this.getState(ue.delta_cell_voltage,3,"0"));const n=parseFloat(this.getState(ue.balancing_current,2,"0")),s=parseFloat(this.getState(ue.power,2,"0")),i=Number(this.getState(ue.balance_trigger_voltage,2,"","number"));this.shouldBalance=this.maxDeltaV>=i;const a=s>0?"power-positive":s<0?"power-negative":"power-even",r=n>0?"balance-positive":n<0?"balance-negative":"balance-even",l=this.shouldBalance?"delta-needs-balancing":"delta-ok",o=this.getState(ue.total_runtime_formatted),c=o&&"unknown"!=o?B(Oe||(Oe=e([' | Time: <b><font color="#3090C7">',"</font></b>"])),o.toUpperCase()):"";return B(Me||(Me=e(['\n      <ha-card>\n        <div class="grid grid-1 p-3 section-padding">\n          <div class="center clickable" @click=',">\n            ","",'\n          </div>\n        </div>\n\n        <div class="grid grid-','">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n          \n          ",'\n\n        <div class="grid grid-2 section-padding">\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," V</font></b>\n            </div>\n              ",' <span class="clickable ','" @click=',">"," W</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," V</span><br>\n              ",' <span class="','">'," A</span>\n              ",'\n          </div>\n\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," A</font></b>\n            </div>\n              ",' <span class="clickable" @click=',">"," %</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">","</span><br>\n              ",' <span class="','" @click=',"> "," V </span><br>\n              ",' <span class="clickable" @click=',">"," °C</span>\n              ",'\n          </div>\n        </div>\n\n          <svg class="flow-line" id="flow-svg">\n              <path id="flow-path" fill="none" />\n          </svg>\n\n          <div class="grid grid-','">\n          ',"\n        </div>\n      </ha-card>\n    "])),(e=>this._navigate(e,ue.total_runtime_formatted)),t,c,"1"==this.config.hasHeater?"4":"3",this._renderSwitch(ue.charging,"charge"),this._renderSwitch(ue.discharging,"discharge"),this._renderSwitch(ue.balancer,"balance"),"1"==this.config.hasHeater?this._renderSwitch(ue.heater,"heater"):"",this._renderError(),(e=>this._navigate(e,ue.total_voltage)),this.getState(ue.total_voltage),$e("stats.power"),a,(e=>this._navigate(e,ue.power)),this.getState(ue.power),$e("stats.capacity"),(e=>this._navigate(e,ue.total_battery_capacity_setting)),this.getState(ue.total_battery_capacity_setting),$e("stats.cycleCapacity"),(e=>this._navigate(e,ue.total_charging_cycle_capacity)),this.getState(ue.total_charging_cycle_capacity),$e("stats.averageCellV"),(e=>this._navigate(e,ue.average_cell_voltage)),this.getState(ue.average_cell_voltage,3),$e("stats.balanceCurrent"),r,n.toFixed(1),this._renderTemps(1),(e=>this._navigate(e,ue.current)),this.getState(ue.current),$e("stats.stateOfCharge"),(e=>this._navigate(e,ue.state_of_charge)),this.getState(ue.state_of_charge),$e("stats.remainingAmps"),(e=>this._navigate(e,ue.capacity_remaining)),this.getState(ue.capacity_remaining),$e("stats.cycles"),(e=>this._navigate(e,ue.charging_cycles)),this.getState(ue.charging_cycles),$e("stats.delta"),l,(e=>this._navigate(e,ue.delta_cell_voltage)),this.maxDeltaV.toFixed(3),$e("stats.mosfetTemp"),(e=>this._navigate(e,ue.power_tube_temperature)),this.getState(ue.power_tube_temperature),this._renderTemps(2),this.config.cellColumns??2,this._renderCells("bankMode"==this.config.cellLayout))}updated(){requestAnimationFrame((()=>this._updateFlowLine()))}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._updateFlowLine.bind(this))}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._updateFlowLine.bind(this))}_renderError(){const t=this.getState(ue.errors,0);return t.trim().length<=1||"0"==t?B(Pe||(Pe=e([""]))):B(De||(De=e(['<span class="error-message">',"</span>"])),t)}_renderTemps(t){const n=[],s=this.config?.tempSensorsCount??0;for(let i=t;i<=s;i+=2)n.push(B(Ne||(Ne=e(["\n                <br>",' <span class="clickable" @click=',">"," °C</span>"])),$e("stats.temperature_sensor_"+i),(e=>this._navigate(e,ue["temperature_sensor_"+i])),this.getState(ue["temperature_sensor_"+i])));return B(Re||(Re=e(["",""])),n)}_renderCells(t=!0){const n=[],s=this.config?.cellColumns??2,i=this.config?.cellCount??16,a=Math.floor(i/s),r=t?Math.ceil(i/s):i,l=i%s;this.minCellId=this.getState(ue.min_voltage_cell,0),this.maxCellId=this.getState(ue.max_voltage_cell,0),!this.minCellId||!this.maxCellId||!this.maxDeltaV||this.maxDeltaV,this.calculateDynamicMinMaxCellId(i);for(let e=1;e<=r;e++)if(t&&l&&e==r?n.push(this._createCell(i)):n.push(this._createCell(e)),t&&(e<r||!l))for(let t=1;t<s;t++)n.push(this._createCell(e+a*t));return B(Te||(Te=e(["",""])),n)}calculateDynamicMinMaxCellId(e){let t=1/0,n=-1/0,s=0,i=0;for(let a=1;a<=e;a++){const e=this.getState(ue["cell_voltage_".concat(a)],3,""),r=parseFloat(e);isNaN(r)||(r>n&&(n=r,i=a),r<t&&(t=r,s=a))}this.minCellId=String(s),this.maxCellId=String(i),this.maxDeltaV=Number((n-t).toFixed(3))}_createCell(t){const n=this.getState(ue["cell_voltage_".concat(t)],3,"0.0"),s=this.getState(ue["cell_resistance_".concat(t)],3),i=this.minCellId,a=this.maxCellId,r=t.toString()===i?"voltage-low":t.toString()===a?"voltage-high":"";let l=""==s?"":B(Ie||(Ie=e(['\n            <span class="clickable" @click=',">\n            / "," Ω\n          </span>"])),(e=>this._navigate(e,ue["cell_resistance_".concat(t)])),s);return B(He||(He=e(['\n            <div class="center cell-container" id="cell-','">\n            <span class="clickable" @click=','>\n                <span class="pill">',"</span>\n            ","\n          </span>\n                ","\n            </div>\n        "])),t,(e=>this._navigate(e,ue["cell_voltage_".concat(t)])),t.toString().padStart(2,"0"),r?B(Ue||(Ue=e(['<span class="','">'," V</span>"])),r,n):B(ze||(ze=e([""," V"])),n),l)}_updateFlowLine(){const e=parseFloat(this.getState(ue.balancing_current,3,"0")),t=this.renderRoot.querySelector("#cell-".concat(this.minCellId)),n=this.renderRoot.querySelector("#cell-".concat(this.maxCellId)),s=this.renderRoot.querySelector("#flow-path");if(!s)return;if(!this.shouldBalance&&0===e||!t||!n)return s.setAttribute("d",""),void(s.style.display="none");s.style.display="inline";const i=(this.renderRoot instanceof ShadowRoot?this.renderRoot.host:this).getBoundingClientRect(),a=t.getBoundingClientRect(),r=e=>{const t=e.left+e.width/2<i.left+i.width/2?"right":"left";return{side:t,x:"right"===t?e.right-i.left:e.left-i.left,y:e.top+e.height/2-i.top}},l=r(n.getBoundingClientRect()),o=r(a);let c;if(l.side===o.side){const e="right"===l.side?l.x+10:l.x-10;c="M ".concat(l.x,",").concat(l.y,"\n             L ").concat(e,",").concat(l.y,"\n             L ").concat(e,",").concat(o.y,"\n             L ").concat(o.x,",").concat(o.y)}else{const e=(l.x+o.x)/2;c="M ".concat(l.x,",").concat(l.y,"\n             L ").concat(e,",").concat(l.y,"\n             L ").concat(e,",").concat(o.y,"\n             L ").concat(o.x,",").concat(o.y)}s.setAttribute("d",c)}};var Fe,Be,Ve,We,qe,Je,Ke,Ge;je.styles=l(Le||(Le=e(["\n        .grid {\n            display: grid;\n            gap: 4px;\n            margin: 4px;\n        }\n\n        .grid-1 {\n            grid-template-columns: 1fr;\n        }\n\n        .grid-2 {\n            grid-template-columns: repeat(2, 1fr);\n        }\n\n        .grid-3 {\n            grid-template-columns: repeat(3, 1fr);\n        }\n\n        .grid-4 {\n            grid-template-columns: repeat(4, 1fr);\n        }\n\n        .grid-5 {\n            grid-template-columns: repeat(5, 1fr);\n        }\n\n        .grid-6 {\n            grid-template-columns: repeat(6, 1fr);\n        }\n\n        .grid-7 {\n            grid-template-columns: repeat(7, 1fr);\n        }\n\n        .grid-8 {\n            grid-template-columns: repeat(8, 1fr);\n        }\n\n        .clickable {\n            cursor: pointer;\n        }\n\n        .section-padding {\n            padding-top: 0.45rem;\n            padding-bottom: 0.75rem;\n        }\n\n        .stats-padding {\n            padding-top: 0.75rem;\n            padding-left: 0.75rem;\n        }\n\n        .power-negative {\n            color: red\n        }\n\n        .power-positive {\n            color: #41cd52\n        }\n\n        .power-even {\n            color: #808080\n        }\n\n        .balance-positive {\n            color: red\n        }\n\n        .balance-negative {\n            color: #3090C7\n        }\n\n        .balance-even {\n            color: #808080\n        }\n\n        .delta-needs-balancing {\n            color: #FFA500\n        }\n\n        .delta-ok {\n            color: #41CD52\n        }\n\n        .stats-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n\n        .button-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n\n        .error-message {\n            color: red;\n            font-style: italic;\n        }\n\n        .button-padding {\n            padding-top: 0.75rem;\n            padding-bottom: 0.75rem;\n        }\n\n        .status-on {\n            color: #41cd52;\n        }\n\n        .status-off {\n            color: red;\n        }\n\n        .voltage-high {\n            color: #3090C7;\n        }\n\n        .voltage-low {\n            color: red;\n        }\n\n        .center {\n            text-align: center;\n        }\n\n        .pill {\n            display: inline-block;\n            padding: 0.15rem 0.25rem;\n            background-color: #195569;\n            color: #e4f3f8;\n            border-radius: 999px;\n            font-weight: 500;\n            font-family: sans-serif;\n            font-size: 0.9rem;\n            min-width: 2rem;\n            text-align: center;\n        }\n\n        .flow-line {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n            z-index: 1;\n        }\n\n        line {\n            stroke: #3090C7;\n            stroke-width: 2;\n            stroke-dasharray: 6;\n            animation: dashmove 1s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n        }\n\n        path {\n            stroke: #3090C7;\n            stroke-width: 3;\n            stroke-linecap: round;\n            fill: none;\n            stroke-dasharray: 10;\n            stroke-dashoffset: 0;\n            animation: dashmove 1.2s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n        }\n\n        @keyframes dashmove {\n            from {\n                stroke-dashoffset: 0;\n            }\n            to {\n                stroke-dashoffset: -20;\n            }\n        }\n    "]))),t([_e()],je.prototype,"hass",void 0),t([_e()],je.prototype,"config",void 0),je=t([ce("jk-bms-default-layout")],je);let Ze=class extends le{constructor(){super(...arguments),this.minCellId="",this.maxCellId="",this.maxDeltaV=0,this.shouldBalance=!1,this.historyData={}}firstUpdated(){this.fetchHistory(),this._historyInterval=window.setInterval((()=>this.fetchHistory()),6e4)}_navigate(e,t,n="sensor"){Ce(e,this.config,t,n)}updated(e){e.has("hass")&&this._updateRealtimeHistory()}_updateRealtimeHistory(){if(!this.hass||!this.config)return;const e=[ue.total_voltage,ue.current,ue.power_tube_temperature,ue.delta_cell_voltage],t=Date.now()-36e5;e.forEach((e=>{const n=this._resolveEntityId(e);if(!n)return;const s=this.hass.states[n];if(!s)return;const i=parseFloat(s.state),a=new Date(s.last_updated).getTime();if(isNaN(i))return;const r=this.historyData[n]||[],l=r.length>0?r[r.length-1]:null;if(!l||a>l.time){const e=[...r,{state:i,time:a}];for(;e.length>0&&e[0].time<t;)e.shift();this.historyData={...this.historyData,[n]:e}}}))}disconnectedCallback(){super.disconnectedCallback(),this._historyInterval&&clearInterval(this._historyInterval)}async fetchHistory(){if(!this.hass||!this.config)return;const e=[this._resolveEntityId(ue.total_voltage),this._resolveEntityId(ue.current),this._resolveEntityId(ue.power_tube_temperature),this._resolveEntityId(ue.delta_cell_voltage)].filter((e=>e)),t=[...new Set(e)];if(0===t.length)return;const n=new Date,s=new Date(n.getTime()-36e5);try{const e=await this.hass.callWS({type:"history/history_during_period",start_time:s.toISOString(),end_time:n.toISOString(),entity_ids:t,minimal_response:!0,no_attributes:!0});if(e){const t={};Object.keys(e).forEach((n=>{const s=e[n];Array.isArray(s)&&(t[n]=s.map((e=>({state:parseFloat(e.s||e.state),time:1e3*(e.lu||new Date(e.last_updated).getTime()/1e3)}))).filter((e=>!isNaN(e.state))))})),this.historyData={...this.historyData,...t}}}catch(e){console.warn("JK BMS Card: Failed to fetch history via WS",e)}}configOrEnum(e){return Se(this.config,e)}_resolveEntityId(e){const t=this.configOrEnum(e);if(t)return t.includes(".")?t:"sensor.".concat(this.config.prefix,"_").concat(t)}_renderSparkline(t,n){const s=this._resolveEntityId(t);if(!s||!this.historyData[s]||this.historyData[s].length<2)return B(Fe||(Fe=e(['\n                <div style="height: 30px;"></div>'])));const i=this.historyData[s];let a=1/0,r=-1/0;i.forEach((e=>{const t=Number(Number(e.state).toFixed(3));t<a&&(a=t),t>r&&(r=t)}));let l=r-a;if(l<1){const e=(a+r)/2;a=e-.5,r=e+.5}else a-=.05*l,r+=.05*l;const o=i[0].time,c=i[i.length-1].time-o;if(c<=0)return B(Be||(Be=e([""])));let h="";return i.forEach(((e,t)=>{const n=(e.time-o)/c*100,s=100-(e.state-a)/(r-a)*100;h+="".concat(0===t?"M":"L"," ").concat(n.toFixed(1),",").concat(s.toFixed(1)," ")})),B(Ve||(Ve=e(['\n            <div class="sparkline-container">\n                <svg class="sparkline-svg" viewBox="0 0 100 100" preserveAspectRatio="none">\n                    <path class="spark-line" d="','" stroke="','"/>\n                    <path class="spark-area" d="',' L 100,100 L 0,100 Z" fill="','"/>\n                </svg>\n            </div>\n        '])),h,n,h,n)}getState(e,t=2,n="",s="sensor"){return ke(this.hass,this.config,e,t,n,s)}render(){if(xe.hass=this.hass,!this.hass||!this.config)return B(We||(We=e([""])));const t=this.config.title||"Bat 1",n=this.getState(ue.total_runtime_formatted),s=n&&"unknown"!=n?B(qe||(qe=e([" | Time: <b>","</b>"])),n.toUpperCase()):"",i=parseFloat(this.getState(ue.current)),a=i>0,r=i<0,l="on"===this.getState(ue.charging,0,"","switch"),o="on"===this.getState(ue.discharging,0,"","switch"),c=this.getState(ue.state_of_charge);this.getState(ue.total_battery_capacity_setting);const h=this.getState(ue.total_voltage),d=this.getState(ue.power_tube_temperature);return this.calculateDynamicMinMax(),B(Je||(Je=e(['\n            <ha-card class="container">\n                <div class="header clickable" @click=',">\n                    "," ",'\n                </div>\n\n                <div class="top-section">\n                    \x3c!-- Solar/Grid Node --\x3e\n                    <div class="flow-node">\n                        <div class="icon-circle clickable"\n                             @click=','>\n                            <ha-icon icon="mdi:solar-power"></ha-icon>\n                        </div>\n                        <div class="node-label">Grid/Solar</div>\n                        <div class="node-status">\n                            Charge: <span\n                                class="','">','</span>\n                        </div>\n                    </div>\n\n                    \x3c!-- Reactor (SOC) --\x3e\n                    <div class="reactor-container">\n                        <div class="reactor-ring clickable"\n                             @click=','>\n                            <div class="soc-label">SOC:</div>\n                            <div class="soc-value">','%</div>\n                            <div class="capacity-val clickable"\n                                 @click=',">\n                                Remaining:<br>",' Ah\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Load Node --\x3e\n                    <div class="flow-node">\n                        <div class="icon-circle clickable"\n                             @click=','>\n                            <ha-icon icon="mdi:power-plug"></ha-icon>\n                        </div>\n                        <div class="node-label">Load</div>\n                        <div class="node-status">\n                            Discharge: <span\n                                class="','">','</span>\n                        </div>\n                    </div>\n\n                    \x3c!-- SVG Flow Lines --\x3e\n                    <svg class="flow-svg" viewBox="0 0 400 180" preserveAspectRatio="none">\n                        \x3c!-- Left path (Charge) - Rough coordinates for now, will refine --\x3e\n                        <path d="M 60,70 Q 120,70 125,90" class="','"/>\n                        \x3c!-- Right path (Discharge) --\x3e\n                        <path d="M 275,90 Q 280,70 340,70"\n                              class="','"\n                              marker-end="url(#arrow)"/>\n\n                        <defs>\n                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto"\n                                    markerUnits="strokeWidth">\n                                <path d="M0,0 L0,6 L9,3 z" fill="','"/>\n                            </marker>\n                        </defs>\n                    </svg>\n                </div>\n\n                \x3c!-- Stats Panels --\x3e\n                <div class="middle-grid">\n                    <div class="stats-panel">\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Total Voltage:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">",' V\n                            </div>\n                        </div>\n\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Current:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">",' A\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="stats-panel">\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">MOS Temp:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">",' °C\n                            </div>\n                        </div>\n\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Delta V:</div>\n                            <div class="stat-value val-green clickable"\n                                 @click=',">",' V\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Cells --\x3e\n                <div class="cell-grid">\n                    ',"\n                </div>\n\n            </ha-card>\n        "])),(e=>this._navigate(e,ue.total_runtime_formatted)),t,s,(e=>this._navigate(e,ue.charging,"switch")),l?"status-on":"status-off",l?"ON":"OFF",(e=>this._navigate(e,ue.state_of_charge)),c,(e=>this._navigate(e,ue.capacity_remaining)),this.getState(ue.capacity_remaining),(e=>this._navigate(e,ue.discharging,"switch")),o?"status-on":"status-off",o?"ON":"OFF",a?"path-charge":"path-inactive",r?"path-discharge":"path-inactive",o?"#3090c7":"#444",this._renderSparkline(ue.total_voltage,"#41CD52"),(e=>this._navigate(e,ue.total_voltage)),h,this._renderSparkline(ue.current,"#3090c7"),(e=>this._navigate(e,ue.current)),i,this._renderSparkline(ue.power_tube_temperature,"#FFA500"),(e=>this._navigate(e,ue.power_tube_temperature)),d,this._renderSparkline(ue.delta_cell_voltage,"#41CD52"),(e=>this._navigate(e,ue.delta_cell_voltage)),this.maxDeltaV,this._renderCells())}calculateDynamicMinMax(){let e=1/0,t=-1/0,n="",s="";const i=this.config.cellCount||16;for(let a=1;a<=i;a++){const i=this.getState(ue["cell_voltage_".concat(a)],3,""),r=parseFloat(i);isNaN(r)||(r<e&&(e=r,n=String(a)),r>t&&(t=r,s=String(a)))}e===1/0||t===-1/0?(this.maxDeltaV=0,this.minCellId="",this.maxCellId=""):(this.minCellId=n,this.maxCellId=s,this.maxDeltaV=parseFloat((t-e).toFixed(3)))}_renderCells(){const t=[],n=this.config.cellCount||16;for(let s=1;s<=n;s++){const n=this.getState(ue["cell_voltage_".concat(s)],3,"0.000"),i=this.getState(ue["cell_resistance_".concat(s)],3,"0.000"),a=String(s)===this.minCellId,r=String(s)===this.maxCellId;let l=a?"cell-low":r?"cell-high":"val-white";const o=parseFloat(n),c=2.8,h=3.65;let d=0;isNaN(o)||(d=(o-c)/(h-c)*100,d<0&&(d=0),d>100&&(d=100)),t.push(B(Ke||(Ke=e(['\n                <div class="cell-item">\n                    <div class="cell-item-bg" style="width: ','%;"></div>\n                    <div style="display:flex; align-items:center;">\n                        <span class="cell-id">','</span>\n                        <span class="cell-volts ',' clickable"\n                              @click=',">",' V</span>\n                    </div>\n                    <span class="cell-res clickable"\n                          @click=',">/ "," Ω</span>\n                </div>\n            "])),d,String(s).padStart(2,"0"),l,(e=>this._navigate(e,ue["cell_voltage_".concat(s)])),n,(e=>this._navigate(e,ue["cell_resistance_".concat(s)])),i))}return t}};var Qe,Xe,Ye,et;Ze.styles=l(Ge||(Ge=e(["\n        :host {\n            --primary-text-color: #e1e1e1;\n            --secondary-text-color: #9b9b9b;\n            --accent-color: #41cd52;\n            --accent-color-dim: rgba(65, 205, 82, 0.2);\n            --discharge-color: #3090c7;\n            --discharge-color-dim: rgba(48, 144, 199, 0.2);\n            --panel-bg: rgba(255, 255, 255, 0.05);\n            --panel-border: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .container {\n            font-family: 'Roboto', sans-serif;\n            color: var(--primary-text-color);\n            padding: 8px;\n            box-sizing: border-box;\n            background: #1c1c1c; /* Fallback/Base dark */\n            border-radius: var(--ha-card-border-radius, 12px);\n        }\n\n        .header {\n            text-align: center;\n            font-size: 1.1em;\n            margin-bottom: 16px;\n            color: var(--secondary-text-color);\n        }\n\n        .header b {\n            color: var(--discharge-color);\n        }\n\n        /* Top Section: Flow & Reactor */\n\n        .top-section {\n            display: grid;\n            grid-template-columns: 1fr 1.2fr 1fr;\n            align-items: center;\n            margin-bottom: 16px;\n            position: relative;\n            height: 180px;\n        }\n\n        .flow-node {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            z-index: 2;\n        }\n\n        .icon-circle {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            border: 2px solid var(--secondary-text-color);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-bottom: 4px;\n            background: #2a2a2a;\n        }\n\n        .icon-circle ha-icon {\n            --mdc-icon-size: 30px;\n        }\n\n        .node-label {\n            font-size: 0.9em;\n            color: var(--secondary-text-color);\n        }\n\n        .node-status {\n            font-size: 0.85em;\n        }\n\n        .reactor-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n            z-index: 2;\n        }\n\n        .reactor-ring {\n            width: 140px;\n            height: 140px;\n            border-radius: 50%;\n            border: 6px solid var(--accent-color);\n            box-shadow: 0 0 15px var(--accent-color-dim);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            background: radial-gradient(circle, rgba(65, 205, 82, 0.1) 0%, rgba(0, 0, 0, 0) 70%);\n        }\n\n        .soc-label {\n            font-size: 0.9em;\n            color: var(--secondary-text-color);\n        }\n\n        .soc-value {\n            font-size: 2.2em;\n            font-weight: bold;\n            color: var(--accent-color);\n        }\n\n        .capacity-val {\n            font-size: 0.85em;\n            color: var(--secondary-text-color);\n            margin-top: -4px;\n        }\n\n        /* Middle Grid */\n\n        .middle-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 8px;\n            margin-bottom: 16px;\n        }\n\n        .stats-panel {\n            background: var(--panel-bg);\n            border: var(--panel-border);\n            border-radius: 10px;\n            padding: 10px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n        }\n\n        .stat-label {\n            font-size: 0.85em;\n            color: var(--secondary-text-color);\n            margin-bottom: 4px;\n        }\n\n        .stat-value {\n            font-size: 1.4em;\n            font-weight: bold;\n        }\n\n        .stat-sub {\n            font-size: 0.8em;\n            color: var(--secondary-text-color);\n            margin-top: 2px;\n        }\n\n        .val-white {\n            color: #fff;\n        }\n\n        .val-green {\n            color: var(--accent-color);\n        }\n\n        .val-blue {\n            color: var(--discharge-color);\n        }\n\n        .val-orange {\n            color: orange;\n        }\n\n        /* Cell Grid */\n\n        .cell-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 6px;\n        }\n\n        .cell-item {\n            background: #2a2a2a;\n            border-radius: 20px;\n            padding: 6px 12px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            font-size: 0.95em;\n            position: relative;\n            overflow: hidden;\n            z-index: 0;\n        }\n\n        .cell-item-bg {\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            background: rgba(48, 144, 199, 0.2);\n            z-index: -1;\n            transition: width 0.5s ease-out;\n        }\n\n        .cell-id {\n            background: #37474f;\n            color: #b0bec5;\n            border-radius: 50%;\n            width: 24px;\n            height: 24px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 0.8em;\n            margin-right: 8px;\n        }\n\n        .cell-volts {\n            color: #e1e1e1;\n            font-family: monospace;\n        }\n\n        .cell-res {\n            color: #90a4ae;\n            font-size: 0.85em;\n            font-family: monospace;\n        }\n\n        .cell-low {\n            color: #FFA500;\n        }\n\n        /* Example warning color */\n\n        .cell-high {\n            color: var(--discharge-color);\n        }\n\n        .status-on {\n            color: var(--accent-color);\n            font-weight: bold;\n        }\n\n        .status-off {\n            color: #666;\n            font-weight: bold;\n        }\n\n        .clickable {\n            cursor: pointer;\n        }\n\n        /* SVG Overlay for Lines */\n\n        .flow-svg {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n            z-index: 1;\n        }\n\n        .flow-svg path {\n            fill: none;\n            stroke-width: 2;\n            stroke-dasharray: 8;\n            animation: flow 1s linear infinite;\n        }\n\n        .path-charge {\n            stroke: var(--accent-color);\n        }\n\n        .path-discharge {\n            stroke: var(--discharge-color);\n        }\n\n        .path-inactive {\n            stroke: #444;\n            stroke-dasharray: 0;\n            animation: none;\n        }\n\n        @keyframes flow {\n            from {\n                stroke-dashoffset: 16;\n            }\n            to {\n                stroke-dashoffset: 0;\n            }\n        }\n\n        /* Sparkline CSS */\n        /* Sparkline CSS */\n\n        .metric-group {\n            position: relative;\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            padding: 8px 0;\n            z-index: 1;\n        }\n\n        .sparkline-container {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            overflow: hidden;\n            opacity: 0.3;\n            z-index: -1;\n            pointer-events: none;\n        }\n\n        .sparkline-svg {\n            width: 100%;\n            height: 100%;\n        }\n\n        .spark-line {\n            fill: none;\n            stroke-width: 2;\n            vector-effect: non-scaling-stroke;\n        }\n\n        .spark-area {\n            fill-opacity: 0.2;\n            stroke: none;\n        }\n    "]))),t([_e()],Ze.prototype,"hass",void 0),t([_e()],Ze.prototype,"config",void 0),t([_e()],Ze.prototype,"historyData",void 0),Ze=t([ce("jk-bms-core-reactor-layout")],Ze);const tt="1.2.0";console.groupCollapsed("%c🔋 JK-BMS Battery Card%c   ready!  🚀 (v".concat(tt,")"),"background: linear-gradient(to right, #41cd52, #3090c7); color: white; font-weight: bold; padding: 2px 8px; border-radius: 6px;","background: none; color: #AAA; font-style: italic;"),console.log("%c📖 Docs:","color: #41cd52; font-weight: bold;","https://github.com/Pho3niX90/jk-bms-card"),console.groupEnd();let nt=et=class extends le{setConfig(e){this._config=et.getStubConfig(),this._config={...this._config,...e}}static getStubConfig(){return{title:$e("title"),prefix:"jk_bms",cellCount:16,cellColumns:2,cellLayout:"bankMode",tempSensorsCount:0,hasHeater:0,entities:Object.keys(ue).reduce(((e,t)=>(e[t]="",e)),{})}}static async getConfigElement(){return await Promise.resolve().then((function(){return rt})),document.createElement(pe)}getCardSize(){return 3}render(){return xe.hass=this.hass,this.hass&&this._config?"core-reactor"===this._config.layout?B(Xe||(Xe=e(["<jk-bms-core-reactor-layout .hass="," .config=","></jk-bms-core-reactor-layout>"])),this.hass,this._config):B(Ye||(Ye=e(["\n    <jk-bms-default-layout .hass="," .config = ","></jk-bms-default-layout>\n        "])),this.hass,this._config):B(Qe||(Qe=e([""])))}};var st,it;t([_e()],nt.prototype,"hass",void 0),t([_e()],nt.prototype,"_config",void 0),nt=et=t([ce(ge)],nt),window.customCards.push({type:ge,name:"JK BMS Card",preview:!0,description:$e("common.description"),configurable:!0});let at=class extends le{constructor(){super(...arguments),this._computeLabelCallback=e=>$e("config.".concat(e.name))??e.name}setConfig(e){this._config={...this._config,...e}}render(){if(!this._config||!this.hass)return B(st||(st=e([""])));const t=Object.values(ue).map((e=>({name:e,selector:{entity:{}}})));return B(it||(it=e(["\n\t\t\t<ha-form\n\t\t\t\t.hass=","\n\t\t\t\t.data=","\n\t\t\t\t.computeLabel=","\n\t\t\t\t.schema=","\n\t\t\t\t@value-changed=","\n\t\t\t></ha-form>\n\t\t"])),this.hass,this._config,this._computeLabelCallback.bind(this),[{type:"grid",title:$e("config.title"),schema:[{type:"grid",schema:[{name:"title",selector:{text:{}}}]}]},{type:"grid",title:$e("config.prefix"),schema:[{type:"grid",schema:[{name:"prefix",selector:{text:{}}}]}]},{type:"grid",title:$e("config.layout"),schema:[{type:"grid",schema:[{name:"layout",selector:{select:{options:[{label:"Default",value:"default"},{label:"Core Reactor",value:"core-reactor"}]}}}]}]},{type:"grid",title:$e("config.cellCount"),schema:[{type:"grid",schema:[{name:"cellCount",selector:{number:{min:2,max:48,step:2}}},{name:"cellColumns",selector:{number:{min:1,max:8,step:1}}},{name:"cellLayout",selector:{select:{options:[{label:"Incremental",value:"incremental"},{label:"Bank Mode",value:"bankMode"}]}}}]}]},{type:"grid",title:$e("config.tempSensorsCount"),schema:[{type:"grid",schema:[{name:"tempSensorsCount",selector:{number:{min:0,max:4,step:2}}}]}]},{type:"grid",title:$e("config.hasHeater"),schema:[{type:"grid",schema:[{name:"hasHeater",selector:{select:{multiple:!1,mode:"list",options:[{label:"Yes",value:"1"},{label:"No",value:"0"}]}}}]}]},{type:"expandable",title:$e("config.manualAssignment"),schema:[{name:"entities",type:"grid",schema:t}]}],this._valueChanged.bind(this))}_valueChanged(e){!function(e,t,n,s){s=s||{},n=null==n?{}:n;const i=new Event(t,{bubbles:void 0===s.bubbles||s.bubbles,cancelable:Boolean(s.cancelable),composed:void 0===s.composed||s.composed});i.detail=n,e.dispatchEvent(i)}(this,"config-changed",{config:e.detail.value})}};t([_e()],at.prototype,"hass",void 0),t([_e()],at.prototype,"_config",void 0),t([_e()],at.prototype,"lovelace",void 0),at=t([ce(pe)],at);var rt=Object.freeze({__proto__:null,get JkBmsCardEditor(){return at}});export{tt as CARD_VERSION,nt as JkBmsCard};
